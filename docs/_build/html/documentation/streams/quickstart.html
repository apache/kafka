

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Run Kafka Streams Demo Application &mdash; Apache Kafka 4.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Apache Kafka 4.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="Kafka Streams" href="index.html"/>
        <link rel="next" title="Tutorial: Write a Kafka Streams Application" href="tutorial.html"/>
        <link rel="prev" title="Kafka Streams" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Kafka
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uses.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Apache Kafka Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Kafka APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../implementation.html">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ops.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connect.html">Kafka Connect</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Kafka Streams</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Run Kafka Streams Demo Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-download-the-code">Step 1: Download the code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-start-the-kafka-server">Step 2: Start the Kafka server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-prepare-input-topic-and-start-kafka-producer">Step 3: Prepare input topic and start Kafka producer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-start-the-wordcount-application">Step 4: Start the Wordcount Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-process-some-data">Step 5: Process some data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-teardown-the-application">Step 6: Teardown the application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tutorial.html">Tutorial: Write a Kafka Streams Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="core-concepts.html">Core Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer-guide/index.html">Developer Guide for Kafka Streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade-guide.html">Upgrade Guide and API Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#why-you-ll-love-using-kafka-streams">Why you&#8217;ll love using Kafka Streams!</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#kafka-streams-use-cases">Kafka Streams use cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#hello-kafka-streams">Hello Kafka Streams</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Kafka</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Apache Kafka Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Kafka Streams</a> &raquo;</li>
        
      <li>Run Kafka Streams Demo Application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/documentation/streams/quickstart.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="run-kafka-streams-demo-application">
<h1>Run Kafka Streams Demo Application<a class="headerlink" href="#run-kafka-streams-demo-application" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#step-1-download-the-code" id="id1">Step 1: Download the code</a></li>
<li><a class="reference internal" href="#step-2-start-the-kafka-server" id="id2">Step 2: Start the Kafka server</a></li>
<li><a class="reference internal" href="#step-3-prepare-input-topic-and-start-kafka-producer" id="id3">Step 3: Prepare input topic and start Kafka producer</a></li>
<li><a class="reference internal" href="#step-4-start-the-wordcount-application" id="id4">Step 4: Start the Wordcount Application</a></li>
<li><a class="reference internal" href="#step-5-process-some-data" id="id5">Step 5: Process some data</a></li>
<li><a class="reference internal" href="#step-6-teardown-the-application" id="id6">Step 6: Teardown the application</a></li>
</ul>
</div>
<p>This tutorial assumes you are starting fresh and have no existing Kafka
or ZooKeeper data. However, if you have already started Kafka and
ZooKeeper, feel free to skip the first two steps.</p>
<p>Kafka Streams is a client library for building mission-critical
real-time applications and microservices, where the input and/or output
data is stored in Kafka clusters. Kafka Streams combines the simplicity
of writing and deploying standard Java and Scala applications on the
client side with the benefits of Kafka&#8217;s server-side cluster technology
to make these applications highly scalable, elastic, fault-tolerant,
distributed, and much more.</p>
<p>This quickstart example will demonstrate how to run a streaming
application coded in this library. Here is the gist of the
<code class="docutils literal"><span class="pre">WordCountDemo</span></code> example code (converted to use Java 8 lambda
expressions for easy reading).</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>// Serializers/deserializers (serde) for String and Long types
final Serde&lt;String&gt; stringSerde = Serdes.String();
final Serde&lt;Long&gt; longSerde = Serdes.Long();

// Construct a `KStream` from the input topic &quot;streams-plaintext-input&quot;, where message values
// represent lines of text (for the sake of this example, we ignore whatever may be stored
// in the message keys).
KStream&lt;String, String&gt; textLines = builder.stream(&quot;streams-plaintext-input&quot;,
    Consumed.with(stringSerde, stringSerde);

KTable&lt;String, Long&gt; wordCounts = textLines
    // Split each text line, by whitespace, into words.
    .flatMapValues(value -&gt; Arrays.asList(value.toLowerCase().split(&quot;\\W+&quot;)))

    // Group the text words as message keys
    .groupBy((key, value) -&gt; value)

    // Count the occurrences of each word (message key).
    .count()

// Store the running counts as a changelog stream to the output topic.
wordCounts.toStream().to(&quot;streams-wordcount-output&quot;, Produced.with(Serdes.String(), Serdes.Long()));
</pre></div>
</div>
<p>It implements the WordCount algorithm, which computes a word occurrence
histogram from the input text. However, unlike other WordCount examples
you might have seen before that operate on bounded data, the WordCount
demo application behaves slightly differently because it is designed to
operate on an <strong>infinite, unbounded stream</strong> of data. Similar to the
bounded variant, it is a stateful algorithm that tracks and updates the
counts of words. However, since it must assume potentially unbounded
input data, it will periodically output its current state and results
while continuing to process more data because it cannot know when it has
processed &#8220;all&#8221; the input data.</p>
<p>As the first step, we will start Kafka (unless you already have it
started) and then we will prepare input data to a Kafka topic, which
will subsequently be processed by a Kafka Streams application.</p>
<div class="section" id="step-1-download-the-code">
<h2><a class="reference external" href="#quickstart_streams_download">Step 1: Download the code</a><a class="headerlink" href="#step-1-download-the-code" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.apache.org/dyn/closer.cgi?path=/kafka/%7B%7BfullDotVersion%7D%7D/kafka_%7B%7BscalaVersion%7D%7D-%7B%7BfullDotVersion%7D%7D.tgz">Download</a>
the {{fullDotVersion}} release and un-tar it. Note that there are
multiple downloadable Scala versions and we choose to use the
recommended version ({{scalaVersion}}) here:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">tar</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">kafka_</span><span class="p">{{</span><span class="n">scalaVersion</span><span class="p">}}</span><span class="o">-</span><span class="p">{{</span><span class="n">fullDotVersion</span><span class="p">}}</span><span class="o">.</span><span class="n">tgz</span>
<span class="o">&gt;</span> <span class="n">cd</span> <span class="n">kafka_</span><span class="p">{{</span><span class="n">scalaVersion</span><span class="p">}}</span><span class="o">-</span><span class="p">{{</span><span class="n">fullDotVersion</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-start-the-kafka-server">
<h2><a class="reference external" href="#quickstart_streams_startserver">Step 2: Start the Kafka server</a><a class="headerlink" href="#step-2-start-the-kafka-server" title="Permalink to this headline">¶</a></h2>
<p>Kafka uses <a class="reference external" href="https://zookeeper.apache.org/">ZooKeeper</a> so you need to
first start a ZooKeeper server if you don&#8217;t already have one. You can
use the convenience script packaged with kafka to get a quick-and-dirty
single-node ZooKeeper instance.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">start</span><span class="o">.</span><span class="n">sh</span> <span class="n">config</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">.</span><span class="n">properties</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="mi">495</span><span class="p">]</span> <span class="n">INFO</span> <span class="n">Reading</span> <span class="n">configuration</span> <span class="n">from</span><span class="p">:</span> <span class="n">config</span><span class="o">/</span><span class="n">zookeeper</span><span class="o">.</span><span class="n">properties</span> <span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">zookeeper</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">quorum</span><span class="o">.</span><span class="n">QuorumPeerConfig</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Now start the Kafka server:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">start</span><span class="o">.</span><span class="n">sh</span> <span class="n">config</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">properties</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">028</span><span class="p">]</span> <span class="n">INFO</span> <span class="n">Verifying</span> <span class="n">properties</span> <span class="p">(</span><span class="n">kafka</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">VerifiableProperties</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">051</span><span class="p">]</span> <span class="n">INFO</span> <span class="n">Property</span> <span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">bytes</span> <span class="ow">is</span> <span class="n">overridden</span> <span class="n">to</span> <span class="mi">1048576</span> <span class="p">(</span><span class="n">kafka</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">VerifiableProperties</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-prepare-input-topic-and-start-kafka-producer">
<h2><a class="reference external" href="#quickstart_streams_prepare">Step 3: Prepare input topic and start Kafka producer</a><a class="headerlink" href="#step-3-prepare-input-topic-and-start-kafka-producer" title="Permalink to this headline">¶</a></h2>
<p>Next, we create the input topic named <strong>streams-plaintext-input</strong> and
the output topic named <strong>streams-wordcount-output</strong>:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">topics</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">create</span> \
    <span class="o">--</span><span class="n">zookeeper</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">2181</span> \
    <span class="o">--</span><span class="n">replication</span><span class="o">-</span><span class="n">factor</span> <span class="mi">1</span> \
    <span class="o">--</span><span class="n">partitions</span> <span class="mi">1</span> \
    <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">plaintext</span><span class="o">-</span><span class="nb">input</span>
<span class="n">Created</span> <span class="n">topic</span> <span class="s2">&quot;streams-plaintext-input&quot;</span><span class="o">.</span>
</pre></div>
</div>
<p>Note: we create the output topic with compaction enabled because the
output stream is a changelog stream (cf. <a class="reference external" href="#anchor-changelog-output">explanation of application
output</a> below).</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">topics</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">create</span> \
    <span class="o">--</span><span class="n">zookeeper</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">2181</span> \
    <span class="o">--</span><span class="n">replication</span><span class="o">-</span><span class="n">factor</span> <span class="mi">1</span> \
    <span class="o">--</span><span class="n">partitions</span> <span class="mi">1</span> \
    <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span> \
    <span class="o">--</span><span class="n">config</span> <span class="n">cleanup</span><span class="o">.</span><span class="n">policy</span><span class="o">=</span><span class="n">compact</span>
<span class="n">Created</span> <span class="n">topic</span> <span class="s2">&quot;streams-wordcount-output&quot;</span><span class="o">.</span>
</pre></div>
</div>
<p>The created topic can be described with the same <strong>kafka-topics</strong> tool:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">topics</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">zookeeper</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">2181</span> <span class="o">--</span><span class="n">describe</span>

<span class="n">Topic</span><span class="p">:</span><span class="n">streams</span><span class="o">-</span><span class="n">plaintext</span><span class="o">-</span><span class="nb">input</span>   <span class="n">PartitionCount</span><span class="p">:</span><span class="mi">1</span>    <span class="n">ReplicationFactor</span><span class="p">:</span><span class="mi">1</span> <span class="n">Configs</span><span class="p">:</span>
    <span class="n">Topic</span><span class="p">:</span> <span class="n">streams</span><span class="o">-</span><span class="n">plaintext</span><span class="o">-</span><span class="nb">input</span>  <span class="n">Partition</span><span class="p">:</span> <span class="mi">0</span>    <span class="n">Leader</span><span class="p">:</span> <span class="mi">0</span>   <span class="n">Replicas</span><span class="p">:</span> <span class="mi">0</span> <span class="n">Isr</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Topic</span><span class="p">:</span><span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span>  <span class="n">PartitionCount</span><span class="p">:</span><span class="mi">1</span>    <span class="n">ReplicationFactor</span><span class="p">:</span><span class="mi">1</span> <span class="n">Configs</span><span class="p">:</span>
    <span class="n">Topic</span><span class="p">:</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span> <span class="n">Partition</span><span class="p">:</span> <span class="mi">0</span>    <span class="n">Leader</span><span class="p">:</span> <span class="mi">0</span>   <span class="n">Replicas</span><span class="p">:</span> <span class="mi">0</span> <span class="n">Isr</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-start-the-wordcount-application">
<h2><a class="reference external" href="#quickstart_streams_start">Step 4: Start the Wordcount Application</a><a class="headerlink" href="#step-4-start-the-wordcount-application" title="Permalink to this headline">¶</a></h2>
<p>The following command starts the WordCount demo application:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">class</span><span class="o">.</span><span class="n">sh</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">wordcount</span><span class="o">.</span><span class="n">WordCountDemo</span>
</pre></div>
</div>
<p>The demo application will read from the input topic
<strong>streams-plaintext-input</strong>, perform the computations of the WordCount
algorithm on each of the read messages, and continuously write its
current results to the output topic <strong>streams-wordcount-output</strong>. Hence
there won&#8217;t be any STDOUT output except log entries as the results are
written back into in Kafka.</p>
<p>Now we can start the console producer in a separate terminal to write
some input data to this topic:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">producer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">broker</span><span class="o">-</span><span class="nb">list</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">plaintext</span><span class="o">-</span><span class="nb">input</span>
</pre></div>
</div>
<p>and inspect the output of the WordCount demo application by reading from
its output topic with the console consumer in a separate terminal:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">consumer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> \
    <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span> \
    <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">beginning</span> \
    <span class="o">--</span><span class="n">formatter</span> <span class="n">kafka</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">DefaultMessageFormatter</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">key</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">StringDeserializer</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">value</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">LongDeserializer</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-process-some-data">
<h2><a class="reference external" href="#quickstart_streams_process">Step 5: Process some data</a><a class="headerlink" href="#step-5-process-some-data" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s write some message with the console producer into the input
topic <strong>streams-plaintext-input</strong> by entering a single line of text and
then hit &lt;RETURN&gt;. This will send a new message to the input topic,
where the message key is null and the message value is the string
encoded text line that you just entered (in practice, input data for
applications will typically be streaming continuously into Kafka, rather
than being manually entered as we do in this quickstart):</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">producer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">broker</span><span class="o">-</span><span class="nb">list</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">plaintext</span><span class="o">-</span><span class="nb">input</span>
<span class="nb">all</span> <span class="n">streams</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">kafka</span>
</pre></div>
</div>
<p>This message will be processed by the Wordcount application and the
following output data will be written to the
<strong>streams-wordcount-output</strong> topic and printed by the console consumer:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">consumer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> \
    <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span> \
    <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">beginning</span> \
    <span class="o">--</span><span class="n">formatter</span> <span class="n">kafka</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">DefaultMessageFormatter</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">key</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">StringDeserializer</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">value</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">LongDeserializer</span>

<span class="nb">all</span>     <span class="mi">1</span>
<span class="n">streams</span> <span class="mi">1</span>
<span class="n">lead</span>    <span class="mi">1</span>
<span class="n">to</span>      <span class="mi">1</span>
<span class="n">kafka</span>   <span class="mi">1</span>
</pre></div>
</div>
<p>Here, the first column is the Kafka message key in <code class="docutils literal"><span class="pre">java.lang.String</span></code>
format and represents a word that is being counted, and the second
column is the message value in <code class="docutils literal"><span class="pre">java.lang.Long</span></code>format, representing
the word&#8217;s latest count.</p>
<p>Now let&#8217;s continue writing one more message with the console producer
into the input topic <strong>streams-plaintext-input</strong>. Enter the text line
&#8220;hello kafka streams&#8221; and hit &lt;RETURN&gt;. Your terminal should look as
follows:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">producer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">broker</span><span class="o">-</span><span class="nb">list</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">plaintext</span><span class="o">-</span><span class="nb">input</span>
<span class="nb">all</span> <span class="n">streams</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">kafka</span>
<span class="n">hello</span> <span class="n">kafka</span> <span class="n">streams</span>
</pre></div>
</div>
<p>In your other terminal in which the console consumer is running, you
will observe that the WordCount application wrote new output data:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">consumer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> \
    <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span> \
    <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">beginning</span> \
    <span class="o">--</span><span class="n">formatter</span> <span class="n">kafka</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">DefaultMessageFormatter</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">key</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">StringDeserializer</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">value</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">LongDeserializer</span>

<span class="nb">all</span>     <span class="mi">1</span>
<span class="n">streams</span> <span class="mi">1</span>
<span class="n">lead</span>    <span class="mi">1</span>
<span class="n">to</span>      <span class="mi">1</span>
<span class="n">kafka</span>   <span class="mi">1</span>
<span class="n">hello</span>   <span class="mi">1</span>
<span class="n">kafka</span>   <span class="mi">2</span>
<span class="n">streams</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Here the last printed lines <strong>kafka 2</strong> and <strong>streams 2</strong> indicate
updates to the keys <strong>kafka</strong> and <strong>streams</strong> whose counts have been
incremented from <strong>1</strong> to <strong>2</strong>. Whenever you write further input
messages to the input topic, you will observe new messages being added
to the <strong>streams-wordcount-output</strong> topic, representing the most recent
word counts as computed by the WordCount application. Let&#8217;s enter one
final input text line &#8220;join kafka summit&#8221; and hit &lt;RETURN&gt; in the
console producer to the input topic <strong>streams-wordcount-input</strong> before
we wrap up this quickstart:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>   <span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">producer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">broker</span><span class="o">-</span><span class="nb">list</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="nb">input</span>
   <span class="nb">all</span> <span class="n">streams</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">kafka</span>
   <span class="n">hello</span> <span class="n">kafka</span> <span class="n">streams</span>
   <span class="n">join</span> <span class="n">kafka</span> <span class="n">summit</span>

<span class="n">The</span> <span class="o">**</span><span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span><span class="o">**</span> <span class="n">topic</span> <span class="n">will</span> <span class="n">subsequently</span> <span class="n">show</span> <span class="n">the</span>
</pre></div>
</div>
<p>corresponding updated word counts (see last three lines):</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">bin</span><span class="o">/</span><span class="n">kafka</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">consumer</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> \
    <span class="o">--</span><span class="n">topic</span> <span class="n">streams</span><span class="o">-</span><span class="n">wordcount</span><span class="o">-</span><span class="n">output</span> \
    <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">beginning</span> \
    <span class="o">--</span><span class="n">formatter</span> <span class="n">kafka</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">DefaultMessageFormatter</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="nb">print</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">true</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">key</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">StringDeserializer</span> \
    <span class="o">--</span><span class="nb">property</span> <span class="n">value</span><span class="o">.</span><span class="n">deserializer</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">LongDeserializer</span>

<span class="nb">all</span>     <span class="mi">1</span>
<span class="n">streams</span> <span class="mi">1</span>
<span class="n">lead</span>    <span class="mi">1</span>
<span class="n">to</span>      <span class="mi">1</span>
<span class="n">kafka</span>   <span class="mi">1</span>
<span class="n">hello</span>   <span class="mi">1</span>
<span class="n">kafka</span>   <span class="mi">2</span>
<span class="n">streams</span> <span class="mi">2</span>
<span class="n">join</span>    <span class="mi">1</span>
<span class="n">kafka</span>   <span class="mi">3</span>
<span class="n">summit</span>  <span class="mi">1</span>
</pre></div>
</div>
<p>As one can see, outputs of the Wordcount application is actually a
continuous stream of updates, where each output record (i.e. each line
in the original output above) is an updated count of a single word, aka
record key such as &#8220;kafka&#8221;. For multiple records with the same key, each
later record is an update of the previous one.</p>
<p>The two diagrams below illustrate what is essentially happening behind
the scenes. The first column shows the evolution of the current state of
the <code class="docutils literal"><span class="pre">KTable&lt;String,</span> <span class="pre">Long&gt;</span></code> that is counting word occurrences for
<code class="docutils literal"><span class="pre">count</span></code>. The second column shows the change records that result from
state updates to the KTable and that are being sent to the output Kafka
topic <strong>streams-wordcount-output</strong>.</p>
<p><a class="reference internal" href="../../_images/streams-table-updates-01.png"><img alt="pic1" src="../../_images/streams-table-updates-01.png" style="width: 45%;" /></a> <a class="reference internal" href="../../_images/streams-table-updates-02.png"><img alt="pic2" src="../../_images/streams-table-updates-02.png" style="width: 45%;" /></a></p>
<p>First the text line &#8220;all streams lead to kafka&#8221; is being processed. The
<code class="docutils literal"><span class="pre">KTable</span></code> is being built up as each new word results in a new table
entry (highlighted with a green background), and a corresponding change
record is sent to the downstream <code class="docutils literal"><span class="pre">KStream</span></code>.</p>
<p>When the second text line &#8220;hello kafka streams&#8221; is processed, we
observe, for the first time, that existing entries in the <code class="docutils literal"><span class="pre">KTable</span></code> are
being updated (here: for the words &#8220;kafka&#8221; and for &#8220;streams&#8221;). And
again, change records are being sent to the output topic.</p>
<p>And so on (we skip the illustration of how the third line is being
processed). This explains why the output topic has the contents we
showed above, because it contains the full record of changes.</p>
<p>Looking beyond the scope of this concrete example, what Kafka Streams is
doing here is to leverage the duality between a table and a changelog
stream (here: table = the KTable, changelog stream = the downstream
KStream): you can publish every change of the table to a stream, and if
you consume the entire changelog stream from beginning to end, you can
reconstruct the contents of the table.</p>
</div>
<div class="section" id="step-6-teardown-the-application">
<h2><a class="reference external" href="#quickstart_streams_stop">Step 6: Teardown the application</a><a class="headerlink" href="#step-6-teardown-the-application" title="Permalink to this headline">¶</a></h2>
<p>You can now stop the console consumer, the console producer, the
Wordcount application, the Kafka broker and the ZooKeeper server in
order via <strong>Ctrl-C</strong>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Tutorial: Write a Kafka Streams Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Kafka Streams" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Software Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'4.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>