

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Upgrade Guide and API Changes &mdash; Apache Kafka 4.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Apache Kafka 4.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="Kafka Streams" href="index.html"/>
        <link rel="prev" title="Application Reset Tool" href="developer-guide/app-reset-tool.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Kafka
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uses.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Apache Kafka Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Kafka APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../implementation.html">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ops.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connect.html">Kafka Connect</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Kafka Streams</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="quickstart.html">Run Kafka Streams Demo Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial.html">Tutorial: Write a Kafka Streams Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="core-concepts.html">Core Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer-guide/index.html">Developer Guide for Kafka Streams</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Upgrade Guide and API Changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#streams-api-changes-in-1-1-0">Streams API changes in 1.1.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#streams-api-changes-in-1-0-0">Streams API changes in 1.0.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#streams-api-changes-in-0-11-0-0">Streams API changes in 0.11.0.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notable-changes-in-0-10-2-1">Notable changes in 0.10.2.1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#streams-api-changes-in-0-10-2-0">Streams API changes in 0.10.2.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#streams-api-changes-in-0-10-1-0">Streams API changes in 0.10.1.0</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#why-you-ll-love-using-kafka-streams">Why you&#8217;ll love using Kafka Streams!</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#kafka-streams-use-cases">Kafka Streams use cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#hello-kafka-streams">Hello Kafka Streams</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Kafka</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Apache Kafka Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Kafka Streams</a> &raquo;</li>
        
      <li>Upgrade Guide and API Changes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/documentation/streams/upgrade-guide.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upgrade-guide-and-api-changes">
<h1>Upgrade Guide and API Changes<a class="headerlink" href="#upgrade-guide-and-api-changes" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#streams-api-changes-in-1-1-0" id="id1">Streams API changes in 1.1.0</a></li>
<li><a class="reference internal" href="#streams-api-changes-in-1-0-0" id="id2">Streams API changes in 1.0.0</a></li>
<li><a class="reference internal" href="#streams-api-changes-in-0-11-0-0" id="id3">Streams API changes in 0.11.0.0</a></li>
<li><a class="reference internal" href="#notable-changes-in-0-10-2-1" id="id4">Notable changes in 0.10.2.1</a></li>
<li><a class="reference internal" href="#streams-api-changes-in-0-10-2-0" id="id5">Streams API changes in 0.10.2.0</a></li>
<li><a class="reference internal" href="#streams-api-changes-in-0-10-1-0" id="id6">Streams API changes in 0.10.1.0</a></li>
</ul>
</div>
<p>If you are using Java 7 and want to upgrade from 1.0.x to 1.1.0 you
don&#8217;t need to make any code changes as the public API is fully backward
compatible. If you are using Java 8 method references in your Kafka
Streams code you might need to update your code to resolve method
ambiguties. Hot-swaping the jar-file only might not work for this case.
See <a class="reference external" href="#streams_api_changes_110">below</a> for a complete list of 1.1.0
API and semantic changes that allow you to advance your application
and/or simplify your code base.</p>
<p>If you want to upgrade from 0.11.0.x to 1.0.0 you don&#8217;t need to make any
code changes as the public API is fully backward compatible. However,
some public APIs were deprecated and thus it is recommended to update
your code eventually to allow for future upgrades. See
<a class="reference external" href="#streams_api_changes_100">below</a> for a complete list of 1.0.0 API
and semantic changes that allow you to advance your application and/or
simplify your code base.</p>
<p>If you want to upgrade from 0.10.2.x to 0.11.0 you don&#8217;t need to make
any code changes as the public API is fully backward compatible.
However, some configuration parameters were deprecated and thus it is
recommended to update your code eventually to allow for future upgrades.
See <a class="reference external" href="#streams_api_changes_0110">below</a> for a complete list of 0.11.0
API and semantic changes that allow you to advance your application
and/or simplify your code base.</p>
<p>If you want to upgrade from 0.10.1.x to 0.10.2, see the <a class="reference external" href="/%7B%7Bversion%7D%7D/documentation/#upgrade_1020_streams">**Upgrade
Section for
0.10.2**</a>.
It highlights incompatible changes you need to consider to upgrade your
code and application. See <a class="reference external" href="#streams_api_changes_0102">below</a> for a
complete list of 0.10.2 API and semantic changes that allow you to
advance your application and/or simplify your code base.</p>
<p>If you want to upgrade from 0.10.0.x to 0.10.1, see the <a class="reference external" href="/%7B%7Bversion%7D%7D/documentation/#upgrade_1010_streams">**Upgrade
Section for
0.10.1**</a>.
It highlights incompatible changes you need to consider to upgrade your
code and application. See <a class="reference external" href="#streams_api_changes_0101">below</a> a
complete list of 0.10.1 API changes that allow you to advance your
application and/or simplify your code base, including the usage of new
features.</p>
<div class="section" id="streams-api-changes-in-1-1-0">
<h2><a class="reference external" href="#streams_api_changes_110">Streams API changes in 1.1.0</a><a class="headerlink" href="#streams-api-changes-in-1-1-0" title="Permalink to this headline">¶</a></h2>
<p>We have added support for methods in <code class="docutils literal"><span class="pre">ReadOnlyWindowStore</span></code> which
allows for querying <code class="docutils literal"><span class="pre">WindowStore</span></code>s without the neccesity of
providing keys.</p>
<p>There is a new artifact <code class="docutils literal"><span class="pre">kafka-streams-test-utils</span></code> providing a
<code class="docutils literal"><span class="pre">TopologyTestDriver</span></code>, <code class="docutils literal"><span class="pre">ConsumerRecordFactory</span></code>, and
<code class="docutils literal"><span class="pre">OutputVerifier</span></code> class. You can include the new artifact as a regular
dependency to your unit tests and use the test driver to test your
business logic of your Kafka Streams application. For more details, see
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-247%3A+Add+public+test+utils+for+Kafka+Streams">KIP-247</a>.</p>
<p>The introduction of
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-220%3A+Add+AdminClient+into+Kafka+Streams%27+ClientSupplier">KIP-220</a>
enables you to provide configuration parameters for the embedded admin
client created by Kafka Streams, similar to the embedded producer and
consumer clients. You can provide the configs via <code class="docutils literal"><span class="pre">StreamsConfig</span></code> by
adding the configs with the prefix <code class="docutils literal"><span class="pre">admin.</span></code> as defined by
<code class="docutils literal"><span class="pre">StreamsConfig#adminClientPrefix(String)</span></code> to distinguish them from
configurations of other clients that share the same config names.</p>
<p>New method in <code class="docutils literal"><span class="pre">GlobalKTable</span></code></p>
<ul class="simple">
<li>A method has been provided such that it will return the store name
associated with the <code class="docutils literal"><span class="pre">GlobalKTable</span></code> or <code class="docutils literal"><span class="pre">null</span></code> if the store name is
non-queryable.</li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">KafkaStreams</span></code>:</p>
<ul class="simple">
<li>added overload for the constructor that allows overriding the
<code class="docutils literal"><span class="pre">Time</span></code> object used for tracking system wall-clock time; this is
useful for unit testing your application code.</li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">KafkaClientSupplier</span></code>:</p>
<ul class="simple">
<li>added <code class="docutils literal"><span class="pre">getAdminClient(config)</span></code> that allows to override an
<code class="docutils literal"><span class="pre">AdminClient</span></code> used for administrative requests such as internal
topic creations, etc.</li>
</ul>
<p>New error handling for exceptions during production:</p>
<ul class="simple">
<li>added interface <code class="docutils literal"><span class="pre">ProductionExceptionHandler</span></code> that allows
implementors to decide whether or not Streams should <code class="docutils literal"><span class="pre">FAIL</span></code> or
<code class="docutils literal"><span class="pre">CONTINUE</span></code> when certain exception occur while trying to produce.</li>
<li>provided an implementation, <code class="docutils literal"><span class="pre">DefaultProductionExceptionHandler</span></code>
that always fails, preserving the existing behavior by default.</li>
<li>changing which implementation is used can be done by settings
<code class="docutils literal"><span class="pre">default.production.exception.handler</span></code> to the fully qualified name
of a class implementing this interface.</li>
</ul>
<p>Changes in <code class="docutils literal"><span class="pre">StreamsResetter</span></code>:</p>
<ul class="simple">
<li>added options to specify input topics offsets to reset according to
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-171+-+Extend+Consumer+Group+Reset+Offset+for+Stream+Application">KIP-171</a></li>
</ul>
</div>
<div class="section" id="streams-api-changes-in-1-0-0">
<h2><a class="reference external" href="#streams_api_changes_100">Streams API changes in 1.0.0</a><a class="headerlink" href="#streams-api-changes-in-1-0-0" title="Permalink to this headline">¶</a></h2>
<p>With 1.0 a major API refactoring was accomplished and the new API is
cleaner and easier to use. This change includes the five main classes
<code class="docutils literal"><span class="pre">KafkaStreams</span></code>, <code class="docutils literal"><span class="pre">KStreamBuilder</span></code>, <code class="docutils literal"><span class="pre">KStream</span></code>, <code class="docutils literal"><span class="pre">KTable</span></code>, and
<code class="docutils literal"><span class="pre">TopologyBuilder</span></code> (and some more others). All changes are fully
backward compatible as old API is only deprecated but not removed. We
recommend to move to the new API as soon as you can. We will summarize
all API changes in the next paragraphs.</p>
<p>The two main classes to specify a topology via the DSL
(<code class="docutils literal"><span class="pre">KStreamBuilder</span></code>) or the Processor API (<code class="docutils literal"><span class="pre">TopologyBuilder</span></code>) were
deprecated and replaced by <code class="docutils literal"><span class="pre">StreamsBuilder</span></code> and <code class="docutils literal"><span class="pre">Topology</span></code> (both new
classes are located in package <code class="docutils literal"><span class="pre">org.apache.kafka.streams</span></code>). Note, that
<code class="docutils literal"><span class="pre">StreamsBuilder</span></code> does not extend <code class="docutils literal"><span class="pre">Topology</span></code>, i.e., the class
hierarchy is different now. The new classes have basically the same
methods as the old ones to build a topology via DSL or Processor API.
However, some internal methods that were public in <code class="docutils literal"><span class="pre">KStreamBuilder</span></code>
and <code class="docutils literal"><span class="pre">TopologyBuilder</span></code> but not part of the actual API are not present
in the new classes any longer. Furthermore, some overloads were
simplified compared to the original classes. See
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-120%3A+Cleanup+Kafka+Streams+builder+API">KIP-120</a>
and
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-182%3A+Reduce+Streams+DSL+overloads+and+allow+easier+use+of+custom+storage+engines">KIP-182</a>
for full details.</p>
<p>Changing how a topology is specified also affects <code class="docutils literal"><span class="pre">KafkaStreams</span></code>
constructors, that now only accept a <code class="docutils literal"><span class="pre">Topology</span></code>. Using the DSL builder
class <code class="docutils literal"><span class="pre">StreamsBuilder</span></code> one can get the constructed <code class="docutils literal"><span class="pre">Topology</span></code> via
<code class="docutils literal"><span class="pre">StreamsBuilder#build()</span></code>. Additionally, a new class
<code class="docutils literal"><span class="pre">org.apache.kafka.streams.TopologyDescription</span></code> (and some more
dependent classes) were added. Those can be used to get a detailed
description of the specified topology and can be obtained by calling
<code class="docutils literal"><span class="pre">Topology#describe()</span></code>. An example using this new API is shown in the
<a class="reference external" href="/%7B%7Bversion%7D%7D/documentation/streams/quickstart">quickstart
section</a>.</p>
<p>New methods in <code class="docutils literal"><span class="pre">KStream</span></code>:</p>
<ul class="simple">
<li>With the introduction of
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-202+Move+merge%28%29+from+StreamsBuilder+to+KStream">KIP-202</a>
a new method <code class="docutils literal"><span class="pre">merge()</span></code> has been created in <code class="docutils literal"><span class="pre">KStream</span></code> as the
StreamsBuilder class&#8217;s <code class="docutils literal"><span class="pre">StreamsBuilder#merge()</span></code> has been removed.
The method signature was also changed, too: instead of providing
multiple <code class="docutils literal"><span class="pre">KStream</span></code>s into the method at the once, only a single
<code class="docutils literal"><span class="pre">KStream</span></code> is accepted.</li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">KafkaStreams</span></code>:</p>
<ul class="simple">
<li>retrieve the current runtime information about the local threads via
<code class="docutils literal"><span class="pre">localThreadsMetadata()</span></code></li>
<li>observe the restoration of all state stores via
<code class="docutils literal"><span class="pre">setGlobalStateRestoreListener()</span></code>, in which users can provide their
customized implementation of the
<code class="docutils literal"><span class="pre">org.apache.kafka.streams.processor.StateRestoreListener</span></code> interface</li>
</ul>
<p>Deprecated / modified methods in <code class="docutils literal"><span class="pre">KafkaStreams</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">toString()</span></code>, <code class="docutils literal"><span class="pre">toString(final</span> <span class="pre">String</span> <span class="pre">indent)</span></code> were previously
used to return static and runtime information. They have been
deprecated in favor of using the new classes/methods
<code class="docutils literal"><span class="pre">localThreadsMetadata()</span></code> / <code class="docutils literal"><span class="pre">ThreadMetadata</span></code> (returning runtime
information) and <code class="docutils literal"><span class="pre">TopologyDescription</span></code> / <code class="docutils literal"><span class="pre">Topology#describe()</span></code>
(returning static information).</li>
<li>With the introduction of
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-182%3A+Reduce+Streams+DSL+overloads+and+allow+easier+use+of+custom+storage+engines">KIP-182</a>
you should no longer pass in <code class="docutils literal"><span class="pre">Serde</span></code> to <code class="docutils literal"><span class="pre">KStream#print</span></code>
operations. If you can&#8217;t rely on using <code class="docutils literal"><span class="pre">toString</span></code> to print your
keys an values, you should instead you provide a custom
<code class="docutils literal"><span class="pre">KeyValueMapper</span></code> via the <code class="docutils literal"><span class="pre">Printed#withKeyValueMapper</span></code> call.</li>
<li><code class="docutils literal"><span class="pre">setStateListener()</span></code> now can only be set before the application
start running, i.e. before <code class="docutils literal"><span class="pre">KafkaStreams.start()</span></code> is called.</li>
</ul>
<p>Deprecated methods in <code class="docutils literal"><span class="pre">KGroupedStream</span></code></p>
<ul class="simple">
<li>Windowed aggregations have been deprecated from <code class="docutils literal"><span class="pre">KGroupedStream</span></code>
and moved to <code class="docutils literal"><span class="pre">WindowedKStream</span></code>. You can now perform a windowed
aggregation by, for example, using
<code class="docutils literal"><span class="pre">KGroupedStream#windowedBy(Windows)#reduce(Reducer)</span></code>.</li>
</ul>
<p>Modified methods in <code class="docutils literal"><span class="pre">Processor</span></code>:</p>
<ul>
<li><p class="first">The Processor API was extended to allow users to schedule
<code class="docutils literal"><span class="pre">punctuate</span></code> functions either based on data-driven <strong>stream time</strong>
or wall-clock time. As a result, the original
<code class="docutils literal"><span class="pre">ProcessorContext#schedule</span></code> is deprecated with a new overloaded
function that accepts a user customizable <code class="docutils literal"><span class="pre">Punctuator</span></code> callback
interface, which triggers its <code class="docutils literal"><span class="pre">punctuate</span></code> API method periodically
based on the <code class="docutils literal"><span class="pre">PunctuationType</span></code>. The <code class="docutils literal"><span class="pre">PunctuationType</span></code> determines
what notion of time is used for the punctuation scheduling: either
<a class="reference external" href="/%7B%7Bversion%7D%7D/documentation/streams/core-concepts#streams_time">stream
time</a>
or wall-clock time (by default, <strong>stream time</strong> is configured to
represent event time via <code class="docutils literal"><span class="pre">TimestampExtractor</span></code>). In addition, the
<code class="docutils literal"><span class="pre">punctuate</span></code> function inside <code class="docutils literal"><span class="pre">Processor</span></code> is also deprecated.</p>
<p>Before this, users could only schedule based on stream time (i.e.
<code class="docutils literal"><span class="pre">PunctuationType.STREAM_TIME</span></code>) and hence the <code class="docutils literal"><span class="pre">punctuate</span></code> function
was data-driven only because stream time is determined (and advanced
forward) by the timestamps derived from the input data. If there is
no data arriving at the processor, the stream time would not advance
and hence punctuation will not be triggered. On the other hand, When
wall-clock time (i.e. <code class="docutils literal"><span class="pre">PunctuationType.WALL_CLOCK_TIME</span></code>) is used,
<code class="docutils literal"><span class="pre">punctuate</span></code> will be triggered purely based on wall-clock time. So
for example if the <code class="docutils literal"><span class="pre">Punctuator</span></code> function is scheduled based on
<code class="docutils literal"><span class="pre">PunctuationType.WALL_CLOCK_TIME</span></code>, if these 60 records were
processed within 20 seconds, <code class="docutils literal"><span class="pre">punctuate</span></code> would be called 2 times
(one time every 10 seconds); if these 60 records were processed
within 5 seconds, then no <code class="docutils literal"><span class="pre">punctuate</span></code> would be called at all. Users
can schedule multiple <code class="docutils literal"><span class="pre">Punctuator</span></code> callbacks with different
<code class="docutils literal"><span class="pre">PunctuationType</span></code>s within the same processor by simply calling
<code class="docutils literal"><span class="pre">ProcessorContext#schedule</span></code> multiple times inside processor&#8217;s
<code class="docutils literal"><span class="pre">init()</span></code> method.</p>
</li>
</ul>
<p>If you are monitoring on task level or processor-node / state store
level Streams metrics, please note that the metrics sensor name and
hierarchy was changed: The task ids, store names and processor names are
no longer in the sensor metrics names, but instead are added as tags of
the sensors to achieve consistent metrics hierarchy. As a result you may
need to make corresponding code changes on your metrics reporting and
monitoring tools when upgrading to 1.0.0. Detailed metrics sensor can be
found in the <a class="reference external" href="#kafka_streams_monitoring">Streams Monitoring</a> section.</p>
<p>The introduction of
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-161%3A+streams+deserialization+exception+handlers">KIP-161</a>
enables you to provide a default exception handler for deserialization
errors when reading data from Kafka rather than throwing the exception
all the way out of your streams application. You can provide the configs
via the <code class="docutils literal"><span class="pre">StreamsConfig</span></code> as
<code class="docutils literal"><span class="pre">StreamsConfig#DEFAULT_DESERIALIZATION_EXCEPTION_HANDLER_CLASS_CONFIG</span></code>.
The specified handler must implement the
<code class="docutils literal"><span class="pre">org.apache.kafka.streams.errors.DeserializationExceptionHandler</span></code>
interface.</p>
<p>The introduction of
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-173%3A+Add+prefix+to+StreamsConfig+to+enable+setting+default+internal+topic+configs">KIP-173</a>
enables you to provide topic configuration parameters for any topics
created by Kafka Streams. This includes repartition and changelog
topics. You can provide the configs via the <code class="docutils literal"><span class="pre">StreamsConfig</span></code> by adding
the configs with the prefix as defined by
<code class="docutils literal"><span class="pre">StreamsConfig#topicPrefix(String)</span></code>. Any properties in the
<code class="docutils literal"><span class="pre">StreamsConfig</span></code> with the prefix will be applied when creating internal
topics. Any configs that aren&#8217;t topic configs will be ignored. If you
already use <code class="docutils literal"><span class="pre">StateStoreSupplier</span></code> or <code class="docutils literal"><span class="pre">Materialized</span></code> to provide
configs for changelogs, then they will take precedence over those
supplied in the config.</p>
</div>
<div class="section" id="streams-api-changes-in-0-11-0-0">
<h2><a class="reference external" href="#streams_api_changes_0110">Streams API changes in 0.11.0.0</a><a class="headerlink" href="#streams-api-changes-in-0-11-0-0" title="Permalink to this headline">¶</a></h2>
<p>Updates in <code class="docutils literal"><span class="pre">StreamsConfig</span></code>:</p>
<ul class="simple">
<li>new configuration parameter <code class="docutils literal"><span class="pre">processing.guarantee</span></code> is added</li>
<li>configuration parameter <code class="docutils literal"><span class="pre">key.serde</span></code> was deprecated and replaced by
<code class="docutils literal"><span class="pre">default.key.serde</span></code></li>
<li>configuration parameter <code class="docutils literal"><span class="pre">value.serde</span></code> was deprecated and replaced
by <code class="docutils literal"><span class="pre">default.value.serde</span></code></li>
<li>configuration parameter <code class="docutils literal"><span class="pre">timestamp.extractor</span></code> was deprecated and
replaced by <code class="docutils literal"><span class="pre">default.timestamp.extractor</span></code></li>
<li>method <code class="docutils literal"><span class="pre">keySerde()</span></code> was deprecated and replaced by
<code class="docutils literal"><span class="pre">defaultKeySerde()</span></code></li>
<li>method <code class="docutils literal"><span class="pre">valueSerde()</span></code> was deprecated and replaced by
<code class="docutils literal"><span class="pre">defaultValueSerde()</span></code></li>
<li>new method <code class="docutils literal"><span class="pre">defaultTimestampExtractor()</span></code> was added</li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">TopologyBuilder</span></code>:</p>
<ul class="simple">
<li>added overloads for <code class="docutils literal"><span class="pre">addSource()</span></code> that allow to define a
<code class="docutils literal"><span class="pre">TimestampExtractor</span></code> per source node</li>
<li>added overloads for <code class="docutils literal"><span class="pre">addGlobalStore()</span></code> that allow to define a
<code class="docutils literal"><span class="pre">TimestampExtractor</span></code> per source node associated with the global
store</li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">KStreamBuilder</span></code>:</p>
<ul class="simple">
<li>added overloads for <code class="docutils literal"><span class="pre">stream()</span></code> that allow to define a
<code class="docutils literal"><span class="pre">TimestampExtractor</span></code> per input stream</li>
<li>added overloads for <code class="docutils literal"><span class="pre">table()</span></code> that allow to define a
<code class="docutils literal"><span class="pre">TimestampExtractor</span></code> per input table</li>
<li>added overloads for <code class="docutils literal"><span class="pre">globalKTable()</span></code> that allow to define a
<code class="docutils literal"><span class="pre">TimestampExtractor</span></code> per global table</li>
</ul>
<p>Deprecated methods in <code class="docutils literal"><span class="pre">KTable</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">foreach(final</span> <span class="pre">ForeachAction&lt;?</span> <span class="pre">super</span> <span class="pre">K,</span> <span class="pre">?</span> <span class="pre">super</span> <span class="pre">V&gt;</span> <span class="pre">action)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">print()</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">print(final</span> <span class="pre">String</span> <span class="pre">streamName)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">print(final</span> <span class="pre">Serde&lt;K&gt;</span> <span class="pre">keySerde,</span> <span class="pre">final</span> <span class="pre">Serde&lt;V&gt;</span> <span class="pre">valSerde)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">print(final</span> <span class="pre">Serde&lt;K&gt;</span> <span class="pre">keySerde,</span> <span class="pre">final</span> <span class="pre">Serde&lt;V&gt;</span> <span class="pre">valSerde,</span> <span class="pre">final</span> <span class="pre">String</span> <span class="pre">streamName)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">writeAsText(final</span> <span class="pre">String</span> <span class="pre">filePath)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">writeAsText(final</span> <span class="pre">String</span> <span class="pre">filePath,</span> <span class="pre">final</span> <span class="pre">String</span> <span class="pre">streamName)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">writeAsText(final</span> <span class="pre">String</span> <span class="pre">filePath,</span> <span class="pre">final</span> <span class="pre">Serde&lt;K&gt;</span> <span class="pre">keySerde,</span> <span class="pre">final</span> <span class="pre">Serde&lt;V&gt;</span> <span class="pre">valSerde)</span></code></li>
<li><code class="docutils literal"><span class="pre">void</span> <span class="pre">writeAsText(final</span> <span class="pre">String</span> <span class="pre">filePath,</span> <span class="pre">final</span> <span class="pre">String</span> <span class="pre">streamName,</span> <span class="pre">final</span> <span class="pre">Serde&lt;K&gt;</span> <span class="pre">keySerde,</span> <span class="pre">final</span> <span class="pre">Serde&lt;V&gt;</span> <span class="pre">valSerde)</span></code></li>
</ul>
<p>The above methods have been deprecated in favor of using the Interactive
Queries API. If you want to query the current content of the state store
backing the KTable, use the following approach:</p>
<ul class="simple">
<li>Make a call to
<code class="docutils literal"><span class="pre">KafkaStreams.store(final</span> <span class="pre">String</span> <span class="pre">storeName,</span> <span class="pre">final</span> <span class="pre">QueryableStoreType&lt;T&gt;</span> <span class="pre">queryableStoreType)</span></code></li>
<li>Then make a call to <code class="docutils literal"><span class="pre">ReadOnlyKeyValueStore.all()</span></code> to iterate over
the keys of a <code class="docutils literal"><span class="pre">KTable</span></code>.</li>
</ul>
<p>If you want to view the changelog stream of the <code class="docutils literal"><span class="pre">KTable</span></code> then you
could call <code class="docutils literal"><span class="pre">KTable.toStream().print(Printed.toSysOut)</span></code>.</p>
<p>Metrics using exactly-once semantics:</p>
<p>If exactly-once processing is enabled via the <code class="docutils literal"><span class="pre">processing.guarantees</span></code>
parameter, internally Streams switches from a producer per thread to a
producer per task runtime model. In order to distinguish the different
producers, the producer&#8217;s <code class="docutils literal"><span class="pre">client.id</span></code> additionally encodes the task-ID
for this case. Because the producer&#8217;s <code class="docutils literal"><span class="pre">client.id</span></code> is used to report
JMX metrics, it might be required to update tools that receive those
metrics.</p>
<p>Producer&#8217;s <code class="docutils literal"><span class="pre">client.id</span></code> naming schema:</p>
<ul class="simple">
<li>at-least-once (default):
<code class="docutils literal"><span class="pre">[client.Id]-StreamThread-[sequence-number]</span></code></li>
<li>exactly-once: <code class="docutils literal"><span class="pre">[client.Id]-StreamThread-[sequence-number]-[taskId]</span></code></li>
</ul>
<p><code class="docutils literal"><span class="pre">[client.Id]</span></code> is either set via Streams configuration parameter
<code class="docutils literal"><span class="pre">client.id</span></code> or defaults to <code class="docutils literal"><span class="pre">[application.id]-[processId]</span></code>
(<code class="docutils literal"><span class="pre">[processId]</span></code> is a random UUID).</p>
</div>
<div class="section" id="notable-changes-in-0-10-2-1">
<h2><a class="reference external" href="#streams_api_changes_01021">Notable changes in 0.10.2.1</a><a class="headerlink" href="#notable-changes-in-0-10-2-1" title="Permalink to this headline">¶</a></h2>
<p>Parameter updates in <code class="docutils literal"><span class="pre">StreamsConfig</span></code>:</p>
<ul class="simple">
<li>The default config values of embedded producer&#8217;s <code class="docutils literal"><span class="pre">retries</span></code> and
consumer&#8217;s <code class="docutils literal"><span class="pre">max.poll.interval.ms</span></code> have been changed to improve the
resiliency of a Kafka Streams application</li>
</ul>
</div>
<div class="section" id="streams-api-changes-in-0-10-2-0">
<h2><a class="reference external" href="#streams_api_changes_0102">Streams API changes in 0.10.2.0</a><a class="headerlink" href="#streams-api-changes-in-0-10-2-0" title="Permalink to this headline">¶</a></h2>
<p>New methods in <code class="docutils literal"><span class="pre">KafkaStreams</span></code>:</p>
<ul class="simple">
<li>set a listener to react on application state change via
<code class="docutils literal"><span class="pre">setStateListener(StateListener</span> <span class="pre">listener)</span></code></li>
<li>retrieve the current application state via <code class="docutils literal"><span class="pre">state()</span></code></li>
<li>retrieve the global metrics registry via <code class="docutils literal"><span class="pre">metrics()</span></code></li>
<li>apply a timeout when closing an application via
<code class="docutils literal"><span class="pre">close(long</span> <span class="pre">timeout,</span> <span class="pre">TimeUnit</span> <span class="pre">timeUnit)</span></code></li>
<li>specify a custom indent when retrieving Kafka Streams information via
<code class="docutils literal"><span class="pre">toString(String</span> <span class="pre">indent)</span></code></li>
</ul>
<p>Parameter updates in <code class="docutils literal"><span class="pre">StreamsConfig</span></code>:</p>
<ul class="simple">
<li>parameter <code class="docutils literal"><span class="pre">zookeeper.connect</span></code> was deprecated; a Kafka Streams
application does no longer interact with ZooKeeper for topic
management but uses the new broker admin protocol (cf. <a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-4+-+Command+line+and+centralized+administrative+operations#KIP-4-Commandlineandcentralizedadministrativeoperations-TopicAdminSchema.1">KIP-4,
Section &#8220;Topic Admin
Schema&#8221;</a>)</li>
<li>added many new parameters for metrics, security, and client
configurations</li>
</ul>
<p>Changes in <code class="docutils literal"><span class="pre">StreamsMetrics</span></code> interface:</p>
<ul class="simple">
<li>removed methods: <code class="docutils literal"><span class="pre">addLatencySensor()</span></code></li>
<li>added methods: <code class="docutils literal"><span class="pre">addLatencyAndThroughputSensor()</span></code>,
<code class="docutils literal"><span class="pre">addThroughputSensor()</span></code>, <code class="docutils literal"><span class="pre">recordThroughput()</span></code>, <code class="docutils literal"><span class="pre">addSensor()</span></code>,
<code class="docutils literal"><span class="pre">removeSensor()</span></code></li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">TopologyBuilder</span></code>:</p>
<ul class="simple">
<li>added overloads for <code class="docutils literal"><span class="pre">addSource()</span></code> that allow to define a
<code class="docutils literal"><span class="pre">auto.offset.reset</span></code> policy per source node</li>
<li>added methods <code class="docutils literal"><span class="pre">addGlobalStore()</span></code> to add global <code class="docutils literal"><span class="pre">StateStore</span></code>s</li>
</ul>
<p>New methods in <code class="docutils literal"><span class="pre">KStreamBuilder</span></code>:</p>
<ul class="simple">
<li>added overloads for <code class="docutils literal"><span class="pre">stream()</span></code> and <code class="docutils literal"><span class="pre">table()</span></code> that allow to define
a <code class="docutils literal"><span class="pre">auto.offset.reset</span></code> policy per input stream/table</li>
<li>added method <code class="docutils literal"><span class="pre">globalKTable()</span></code> to create a <code class="docutils literal"><span class="pre">GlobalKTable</span></code></li>
</ul>
<p>New joins for <code class="docutils literal"><span class="pre">KStream</span></code>:</p>
<ul class="simple">
<li>added overloads for <code class="docutils literal"><span class="pre">join()</span></code> to join with <code class="docutils literal"><span class="pre">KTable</span></code></li>
<li>added overloads for <code class="docutils literal"><span class="pre">join()</span></code> and <code class="docutils literal"><span class="pre">leftJoin()</span></code> to join with
<code class="docutils literal"><span class="pre">GlobalKTable</span></code></li>
<li>note, join semantics in 0.10.2 were improved and thus you might see
different result compared to 0.10.0.x and 0.10.1.x (cf. <a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/Kafka+Streams+Join+Semantics">Kafka
Streams Join
Semantics</a>
in the Apache Kafka wiki)</li>
</ul>
<p>Aligned <code class="docutils literal"><span class="pre">null</span></code>-key handling for <code class="docutils literal"><span class="pre">KTable</span></code> joins:</p>
<ul class="simple">
<li>like all other KTable operations, <code class="docutils literal"><span class="pre">KTable-KTable</span></code> joins do not
throw an exception on <code class="docutils literal"><span class="pre">null</span></code> key records anymore, but drop those
records silently</li>
</ul>
<p>New window type <em>Session Windows</em>:</p>
<ul class="simple">
<li>added class <code class="docutils literal"><span class="pre">SessionWindows</span></code> to specify session windows</li>
<li>added overloads for <code class="docutils literal"><span class="pre">KGroupedStream</span></code> methods <code class="docutils literal"><span class="pre">count()</span></code>,
<code class="docutils literal"><span class="pre">reduce()</span></code>, and <code class="docutils literal"><span class="pre">aggregate()</span></code> to allow session window
aggregations</li>
</ul>
<p>Changes to <code class="docutils literal"><span class="pre">TimestampExtractor</span></code>:</p>
<ul class="simple">
<li>method <code class="docutils literal"><span class="pre">extract()</span></code> has a second parameter now</li>
<li>new default timestamp extractor class <code class="docutils literal"><span class="pre">FailOnInvalidTimestamp</span></code> (it
gives the same behavior as old (and removed) default extractor
<code class="docutils literal"><span class="pre">ConsumerRecordTimestampExtractor</span></code>)</li>
<li>new alternative timestamp extractor classes
<code class="docutils literal"><span class="pre">LogAndSkipOnInvalidTimestamp</span></code> and
<code class="docutils literal"><span class="pre">UsePreviousTimeOnInvalidTimestamps</span></code></li>
</ul>
<p>Relaxed type constraints of many DSL interfaces, classes, and methods
(cf.
<a class="reference external" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-100+-+Relax+Type+constraints+in+Kafka+Streams+API">KIP-100</a>).</p>
</div>
<div class="section" id="streams-api-changes-in-0-10-1-0">
<h2><a class="reference external" href="#streams_api_changes_0101">Streams API changes in 0.10.1.0</a><a class="headerlink" href="#streams-api-changes-in-0-10-1-0" title="Permalink to this headline">¶</a></h2>
<p>Stream grouping and aggregation split into two methods:</p>
<ul class="simple">
<li>old: KStream #aggregateByKey(), #reduceByKey(), and #countByKey()</li>
<li>new: KStream#groupByKey() plus KGroupedStream #aggregate(),
#reduce(), and #count()</li>
<li>Example: stream.countByKey() changes to stream.groupByKey().count()</li>
</ul>
<p>Auto Repartitioning:</p>
<ul class="simple">
<li>a call to through() after a key-changing operator and before an
aggregation/join is no longer required</li>
<li>Example: stream.selectKey(...).through(...).countByKey() changes to
stream.selectKey().groupByKey().count()</li>
</ul>
<p>TopologyBuilder:</p>
<ul class="simple">
<li>methods #sourceTopics(String applicationId) and #topicGroups(String
applicationId) got simplified to #sourceTopics() and #topicGroups()</li>
</ul>
<p>DSL: new parameter to specify state store names:</p>
<ul class="simple">
<li>The new Interactive Queries feature requires to specify a store name
for all source KTables and window aggregation result KTables
(previous parameter &#8220;operator/window name&#8221; is now the storeName)</li>
<li>KStreamBuilder#table(String topic) changes to #topic(String topic,
String storeName)</li>
<li>KTable#through(String topic) changes to #through(String topic, String
storeName)</li>
<li>KGroupedStream #aggregate(), #reduce(), and #count() require
additional parameter &#8220;String storeName&#8221;</li>
<li>Example: stream.countByKey(TimeWindows.of(&#8220;windowName&#8221;, 1000))
changes to stream.groupByKey().count(TimeWindows.of(1000),
&#8220;countStoreName&#8221;)</li>
</ul>
<p>Windowing:</p>
<ul class="simple">
<li>Windows are not named anymore: TimeWindows.of(&#8220;name&#8221;, 1000) changes
to TimeWindows.of(1000) (cf. DSL: new parameter to specify state
store names)</li>
<li>JoinWindows has no default size anymore:
JoinWindows.of(&#8220;name&#8221;).within(1000) changes to JoinWindows.of(1000)</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="developer-guide/app-reset-tool.html" class="btn btn-neutral" title="Application Reset Tool" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Software Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'4.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>